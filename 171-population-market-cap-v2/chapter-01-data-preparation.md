# 第一章：資料準備與前處理

## 學習目標
在這一章中，你將學會：
- 如何將非結構化的資料（圖片、表格）轉換為程式可讀的格式
- 理解 JSON 資料格式的基本結構
- 思考資料庫 Schema 的設計原則

---

## 1.1 數據轉錄

### 為什麼需要資料轉錄？
在實際開發中，我們經常會遇到各種形式的資料來源：
- 紙本文件的掃描圖片
- Excel 表格截圖
- PDF 報告
- 政府開放資料的非標準格式

這些資料無法直接被程式讀取和處理，我們需要將它們轉換為**結構化資料格式**，最常見的就是 JSON 或 CSV。

### 實際操作：轉錄台灣出生人口資料

根據提供的資料圖片，我們可以看到 2016-2025 年的台灣出生人數。讓我們將這些資料轉錄為 JSON 格式。

#### 步驟 1：在專案根目錄建立 `data` 資料夾

```bash
mkdir data
```

#### 步驟 2：建立 `data/taiwan-births.json` 檔案

在你的專案中建立這個檔案，並填入以下內容：

```json
[
  {
    "year": 2016,
    "births": 208440
  },
  {
    "year": 2017,
    "births": 193844
  },
  {
    "year": 2018,
    "births": 181601
  },
  {
    "year": 2019,
    "births": 177767
  },
  {
    "year": 2020,
    "births": 165249
  },
  {
    "year": 2021,
    "births": 153820
  },
  {
    "year": 2022,
    "births": 138986
  },
  {
    "year": 2023,
    "births": 135571
  },
  {
    "year": 2024,
    "births": 134856
  },
  {
    "year": 2025,
    "births": 107812
  }
]
```

### JSON 格式解析

讓我們理解這個 JSON 檔案的結構：

1. **最外層是一個陣列 `[]`**：因為我們有多筆資料（10 年的記錄）
2. **每筆資料是一個物件 `{}`**：包含該年度的完整資訊
3. **物件內有兩個屬性**：
   - `year`（年份）：整數型別
   - `births`（出生人數）：整數型別

#### 為什麼選擇這種格式？

```json
✅ 好的設計（我們的選擇）
[
  {"year": 2016, "births": 208440},
  {"year": 2017, "births": 193844}
]

❌ 不好的設計
{
  "2016": 208440,
  "2017": 193844
}
```

**理由**：
- 第一種格式可以輕鬆新增更多欄位（如：死亡人數、自然增加率）
- 資料庫的 Table 結構通常是「一列一筆記錄」，第一種格式更接近這個概念
- 容易進行排序、篩選等操作

---

## 1.2 資料格式思考與 Schema 設計

在將資料放入資料庫之前，我們需要思考**資料表的結構設計（Schema Design）**。

### 資料表欄位規劃

| 欄位名稱 | 資料型別 | 限制條件 | 說明 |
|---------|---------|---------|------|
| `id` | SERIAL | PRIMARY KEY | 自動遞增的主鍵，用於唯一識別每筆記錄 |
| `year` | INTEGER | NOT NULL, UNIQUE | 年份，必填且不可重複 |
| `births` | INTEGER | NOT NULL | 出生人數，必填 |

### 設計考量

#### 1. 為什麼要有 `id` 欄位？
雖然 `year` 已經可以唯一識別每筆資料，但加入 `id` 有以下好處：
- **標準實務做法**：大多數資料表都有一個獨立的主鍵
- **未來擴充性**：如果未來想記錄「每月」的出生數，`year` 就不夠用了
- **資料庫效能**：整數主鍵的查詢效率通常比較高

#### 2. `year` 應該用 INTEGER 還是 DATE？
```sql
-- 選項 A：使用 INTEGER
year INT NOT NULL

-- 選項 B：使用 DATE
year DATE NOT NULL
```

**我們選擇 INTEGER 的理由**：
- 資料是「年度統計」，不需要精確到月日
- 查詢和顯示更直覺（不用處理 `2016-01-01` 這種格式）
- 節省儲存空間

**但如果資料是每月統計，就應該用 DATE！**

#### 3. 為什麼 `year` 要加 UNIQUE 限制？
```sql
year INT NOT NULL UNIQUE
```

這樣可以防止資料重複：
```sql
-- 這會被資料庫拒絕（Good！）
INSERT INTO taiwan_births (year, births) VALUES (2016, 208440);
INSERT INTO taiwan_births (year, births) VALUES (2016, 999999); -- ❌ 錯誤：year 2016 已存在
```

---

## 1.3 資料驗證與清理

在實際專案中，我們還需要確保資料的品質：

### 檢查清單

#### ✅ 資料完整性
- 每一年都有資料嗎？（2016-2025 共 10 筆）
- 有缺漏的年份嗎？

#### ✅ 資料合理性
```javascript
// 簡單的驗證邏輯
const data = require('./data/taiwan-births.json');

data.forEach(record => {
  // 檢查年份範圍
  if (record.year < 2000 || record.year > 2030) {
    console.warn(`⚠️ 年份異常：${record.year}`);
  }
  
  // 檢查出生人數是否為正數
  if (record.births <= 0) {
    console.warn(`⚠️ 出生人數異常：${record.births}`);
  }
  
  // 檢查是否有極端值（台灣人口約 2300 萬，出生率不可能超過總人口）
  if (record.births > 500000) {
    console.warn(`⚠️ 出生人數過高，可能有誤：${record.births}`);
  }
});

console.log('✅ 資料驗證完成');
```

### 選修：建立 CSV 格式備份

除了 JSON，CSV 也是常見的資料交換格式。建立 `data/taiwan-births.csv`：

```csv
year,births
2016,208440
2017,193844
2018,181601
2019,177767
2020,165249
2021,153820
2022,138986
2023,135571
2024,134856
2025,107812
```

**CSV vs JSON**：
- CSV：更簡潔，Excel 可直接開啟，適合表格資料
- JSON：結構更靈活，JavaScript 原生支援，適合階層式資料

---

## 本章小結

恭喜你完成第一章！你已經學會了：

### 核心技能
✅ 將非結構化資料轉換為 JSON 格式  
✅ 理解資料庫 Schema 的設計原則  
✅ 思考資料型別的選擇（INTEGER vs DATE）  
✅ 使用 UNIQUE 限制確保資料品質  

### 輸出成果
你應該已經建立了以下檔案：
```
your-project/
└── data/
    ├── taiwan-births.json  （必要）
    └── taiwan-births.csv   （選修）
```

---

## 下一章預告

在第二章，我們將會：
- 註冊 Neon 雲端資料庫
- 使用 SQL 語法建立資料表
- 將 JSON 資料匯入到真正的 PostgreSQL 資料庫中

**準備好進入雲端資料庫的世界了嗎？** 🚀

---

## 延伸思考題

1. 如果資料來源是「每月出生數」，你會如何修改 JSON 結構和資料表設計？
2. 假設未來要加入「死亡人數」和「結婚對數」，你會如何擴充現有的資料表？
3. 如果資料有缺漏（例如 2020 年沒有資料），在 JSON 中應該如何表示？用 `null` 還是直接省略該年？

思考這些問題，會幫助你在下一章的資料庫設計中做出更好的決策！
