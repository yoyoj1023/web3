### 橢圓曲線數位簽名 (ECDSA) 入門課程計畫

本課程計畫旨在提供一份關於橢圓曲線數位簽章 (Elliptic Curve Digital Signature Algorithm, ECDSA) 的入門介紹，內容涵蓋基本概念、數學原理的手算演練，以及練習題，讓初學者能以簡單易懂的方式理解其運作原理。

---

### **第一部分：課文——橢圓曲線數位簽名簡介**

#### **1. 什麼是數位簽章？**

想像一下，在紙本文件上，我們用親筆簽名來證明文件的真實性與完整性，表示這份文件確實由「我」所簽署，且內容未經竄改。數位簽章在數位世界扮演同樣的角色，它具備三個主要功能：

*   **身份驗證 (Authentication):** 確認簽署者的身份。
*   **完整性 (Integrity):** 確保訊息在傳輸過程中沒有被修改。
*   **不可否認性 (Non-repudiation):** 簽署者事後無法否認自己簽署過該訊息。

#### **2. 為什麼需要「橢圓曲線」？**

傳統的數位簽章演算法（如 RSA）需要非常長的金鑰（例如 2048 位元）才能達到足夠的安全性。橢圓曲線密碼學 (Elliptic Curve Cryptography, ECC) 的最大優點在於，它能用更短的金鑰長度達到同等的安全強度。例如，一個 256 位元的 ECC 金鑰提供的安全性約等於一個 3072 位元的 RSA 金鑰。這使得 ECDSA 在計算能力和儲存空間有限的環境（如智慧卡、加密貨幣和行動裝置）中特別受歡迎。

#### **3. 橢圓曲線的基本樣貌**

一條橢圓曲線並不是橢圓，它的命名源於其數學方程式與計算橢圓周長的積分式相似。在密碼學中，我們使用的是定義在有限體 (Finite Field) 上的橢圓曲線，其方程式通常表示為：

**y² ≡ x³ + ax + b (mod p)**

其中 `a` 和 `b` 是曲線的常數，而 `p` 是一個很大的質數，代表我們所有的計算都在 0 到 `p-1` 的範圍內進行，並取其餘數。

這條曲線上的點 (x, y) 具有一些有趣的數學特性，尤其是「點加法」運算，這是構成 ECDSA 的基礎。

#### **4. ECDSA 的核心概念**

ECDSA 的運作主要基於兩組金鑰：

*   **私鑰 (Private Key):** 一個隨機選擇的秘密數字，必須妥善保管，用於產生簽章。
*   **公鑰 (Public Key):** 由私鑰透過橢圓曲線上的運算推導出來的一個點 (x, y)，可以公開給任何人，用於驗證簽章。

其安全性基於一個數學難題：從公鑰反推出私鑰在計算上是極度困難的。

#### **5. 簽署與驗證流程**

*   **簽署流程 (Alice 想簽署一則訊息):**
    1.  Alice 使用她的 **私鑰** 和待簽署訊息的雜湊值 (Hash) 進行一系列橢圓曲線運算。
    2.  運算後會產生一個由兩個數字 (r, s) 組成的 **數位簽章**。
    3.  Alice 將原始訊息和這個數位簽章 (r, s) 一起傳送給 Bob。

*   **驗證流程 (Bob 收到訊息後驗證):**
    1.  Bob 取得 Alice 的 **公鑰** (這是公開的)。
    2.  他使用 Alice 的公鑰、收到的訊息雜湊值以及簽章 (r, s) 進行另一組橢圓曲線運算。
    3.  如果運算結果符合特定數學關係，則驗證成功，代表訊息確實由 Alice 簽署且未被竄改。若不符合，則驗證失敗。

---

### **第二部分：手算演練——簡單的數學過程**

為了理解背後的數學原理，我們使用一個非常簡化的橢圓曲線和參數來進行手算。

**場景設定：**
*   橢圓曲線方程式：**y² ≡ x³ + 2x + 2 (mod 17)**
    *   這裡 `a=2`, `b=2`, `p=17`
*   基準點 (Generator Point) **G = (5, 1)** (這是曲線上的一個初始點)
*   Alice 的 **私鑰 d = 6** (一個她自己選的秘密數字)

#### **演練 1：從私鑰產生公鑰**

公鑰 Q 是將基準點 G 與私鑰 d 進行「點乘法」運算得到的。點乘法 `d * G` 實際上是將 G 自己加自己 `d` 次。

**Q = d * G = 6 * G = G + G + G + G + G + G**

我們先來計算 **P = 2G = G + G**：
*   **斜率 λ = (3x₁² + a) / (2y₁) (mod p)**
    *   λ = (3 * 5² + 2) / (2 * 1) (mod 17)
    *   λ = (75 + 2) / 2 (mod 17)
    *   λ = 77 / 2 (mod 17)
    *   為了計算除法，我們要求 2 在 mod 17 下的反元素，即 2 * k ≡ 1 (mod 17)，可得 k=9 (因為 2*9 = 18 ≡ 1)。
    *   λ = 77 * 9 (mod 17) ≡ 9 * 9 (mod 17) = 81 (mod 17) ≡ 13
*   **新點的 x 座標 x₂ = (λ² - x₁ - x₁) (mod p)**
    *   x₂ = (13² - 5 - 5) (mod 17)
    *   x₂ = (169 - 10) (mod 17) ≡ (0 - 10) (mod 17) ≡ -10 (mod 17) ≡ 7
*   **新點的 y 座標 y₂ = (λ(x₁ - x₂) - y₁) (mod p)**
    *   y₂ = (13 * (5 - 7) - 1) (mod 17)
    *   y₂ = (13 * (-2) - 1) (mod 17)
    *   y₂ = (-26 - 1) (mod 17) ≡ (-9 - 1) (mod 17) ≡ -10 (mod 17) ≡ 7
所以 **2G = (7, 7)**。

接著，我們可以繼續計算 **3G = 2G + G**，**4G = 3G + G**... 直到 **6G**。
(為簡化篇幅，此處省略中間步驟)
經過計算可得：
*   3G = (16, 13)
*   4G = (10, 6)
*   5G = (13, 7)
*   **6G = (7, 10)**

因此，Alice 的 **公鑰 Q = (7, 10)**。

#### **演練 2：簽署訊息 (簡化版)**

假設 Alice 要簽署的訊息雜湊值 **z = 3**，並選擇一個隨機數 **k = 4**。

1.  **計算 (x₁, y₁) = k * G = 4 * G**
    *   從上一步已知 **4G = (10, 6)**，所以 x₁ = 10。

2.  **計算 r = x₁ (mod n)**
    *   在實際應用中，n 是曲線上點的階數。此處為簡化，我們直接使用 r = x₁ = 10。
    *   **r = 10**

3.  **計算 s = k⁻¹ * (z + r * d) (mod n)**
    *   同樣，為簡化計算，我們假設 n=19 (一個質數)。
    *   首先計算 k 的反元素 k⁻¹ (mod 19)。求 4 * k⁻¹ ≡ 1 (mod 19)，可得 k⁻¹ = 5 (因為 4*5=20 ≡ 1)。
    *   s = 5 * (3 + 10 * 6) (mod 19)
    *   s = 5 * (3 + 60) (mod 19)
    *   s = 5 * 63 (mod 19)
    *   s = 5 * 6 (mod 19) (因為 63 = 3*19 + 6)
    *   s = 30 (mod 19) ≡ 11
    *   **s = 11**

Alice 產生的簽章就是 **(r, s) = (10, 11)**。

---

### **第三部分：習題**

#### **概念題**

1.  數位簽章主要解決哪三個問題？
2.  相較於 RSA 演算法，橢圓曲線密碼學 (ECC) 最主要的優勢是什麼？
3.  在 ECDSA 中，「私鑰」和「公鑰」哪一個是保密的？哪一個是公開的？

#### **數學計算題**

沿用我們在手算演練中的設定：
*   橢圓曲線：**y² ≡ x³ + 2x + 2 (mod 17)**
*   基準點 **G = (5, 1)**

**題目：**
Bob 的私鑰是 **d = 3**。請計算 Bob 的公鑰 Q 是什麼？
(提示：你需要計算 3G = G + G + G。在演練中我們已經算出了 2G，你可以利用這個結果。)