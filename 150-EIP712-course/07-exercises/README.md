# 第七章：互動式練習

> 通過實作練習鞏固 EIP712 知識

## 🎯 本章目標

- 通過實作鞏固 EIP712 知識
- 學習解決實際問題
- 掌握從需求到實現的完整流程
- 理解真實場景的複雜性

## 📖 練習概覽

本章包含三個難度遞增的練習，每個練習都包含：
- 📋 需求說明
- 🎯 學習目標
- 💡 提示和思路
- 🏁 起始代碼
- ✅ 參考解答
- 🧪 測試案例

---

## 練習結構

```
07-exercises/
├── README.md                        # 本文檔
├── exercise-1-basic/                # 初級：投票簽名系統
│   ├── README.md                    # 需求說明
│   ├── starter/                     # 起始代碼
│   │   ├── VotingSystem.sol
│   │   └── vote-frontend.ts
│   ├── solution/                    # 參考解答
│   │   ├── VotingSystem.sol
│   │   └── vote-frontend.ts
│   └── test/                        # 測試案例
│       └── VotingSystem.test.ts
├── exercise-2-intermediate/         # 中級：NFT 鏈下授權白名單
│   ├── README.md
│   ├── starter/
│   ├── solution/
│   └── test/
└── exercise-3-advanced/             # 高級：Gasless DAO 提案系統
    ├── README.md
    ├── starter/
    ├── solution/
    └── test/
```

---

## 練習 1：投票簽名系統（初級）

### 📋 需求

實現一個簽名投票系統，允許使用者：
1. 鏈下簽署投票
2. 任何人都可以提交簽名到鏈上
3. 批量驗證和統計投票
4. 防止重複投票

### 🎯 學習目標

- [x] 理解 EIP712 的基本結構
- [x] 實現簽名驗證
- [x] 使用 nonce 防止重放
- [x] 前端簽名和提交流程

### 💡 提示

```solidity
// 投票結構
struct Vote {
    uint256 proposalId;  // 提案 ID
    bool support;        // 支持/反對
    address voter;       // 投票者
    uint256 nonce;       // 防止重放
}
```

### 難度：⭐️ (1/5)

### 預估時間：1-2 小時

[👉 開始練習 1](./exercise-1-basic/README.md)

---

## 練習 2：NFT 鏈下授權白名單（中級）

### 📋 需求

實現一個 NFT 鑄造合約，使用簽名白名單：
1. 管理員可以簽署白名單地址
2. 白名單使用者可以使用簽名鑄造 NFT
3. 每個簽名有過期時間
4. 每個地址限制鑄造數量

### 🎯 學習目標

- [x] 使用 deadline 控制簽名有效期
- [x] 實現限額檢查
- [x] 處理多個簽名者（管理員）
- [x] 優化 gas 消耗

### 💡 提示

```solidity
// 鑄造許可結構
struct MintPermit {
    address minter;      // 鑄造者
    uint256 quantity;    // 數量
    uint256 deadline;    // 過期時間
    uint256 nonce;       // 防重放
}
```

### 難度：⭐️⭐️⭐️ (3/5)

### 預估時間：2-3 小時

[👉 開始練習 2](./exercise-2-intermediate/README.md)

---

## 練習 3：Gasless DAO 提案系統（高級）

### 📋 需求

實現一個完整的 gasless DAO 治理系統：
1. 成員可以簽署提案
2. 成員可以簽署投票
3. 任何人都可以提交簽名（支付 gas）
4. 實現提案執行邏輯
5. 包含時間鎖機制

### 🎯 學習目標

- [x] 處理複雜的嵌套結構
- [x] 實現完整的元交易流程
- [x] 管理多種類型的簽名
- [x] 實現時間鎖和執行邏輯
- [x] 優化複雜合約的 gas

### 💡 提示

```solidity
// 提案結構（嵌套）
struct Proposal {
    string title;
    string description;
    address proposer;
    ProposalAction[] actions;  // 嵌套陣列
    uint256 deadline;
}

struct ProposalAction {
    address target;
    uint256 value;
    bytes data;
}
```

### 難度：⭐️⭐️⭐️⭐️⭐️ (5/5)

### 預估時間：4-6 小時

[👉 開始練習 3](./exercise-3-advanced/README.md)

---

## 學習路徑建議

### 🚶 初學者

```
練習 1 → 複習第 1-4 章 → 練習 2
```

### 🏃 進階者

```
練習 1 → 練習 2 → 複習第 5-6 章 → 練習 3
```

### 🏃‍♂️ 高級

```
直接挑戰練習 3，遇到問題查閱前面章節
```

---

## 評分標準

每個練習都會從以下方面評估：

### 功能完整性 (40%)

- [ ] 實現所有需求功能
- [ ] 邊界條件處理正確
- [ ] 錯誤處理完善

### 安全性 (30%)

- [ ] 防止重放攻擊
- [ ] 簽名驗證正確
- [ ] 沒有已知漏洞

### 代碼質量 (20%)

- [ ] 代碼結構清晰
- [ ] 註釋充分
- [ ] 命名規範

### Gas 優化 (10%)

- [ ] 避免不必要的存儲操作
- [ ] 使用適當的數據類型
- [ ] 批量操作優化

---

## 如何使用練習

### 1. 閱讀需求

仔細閱讀每個練習的 README.md，理解需求。

### 2. 從 starter 開始

```bash
cd 07-exercises/exercise-1-basic/starter/
```

起始代碼包含：
- 合約框架
- 必要的導入
- 函數簽名（待實現）
- 測試框架

### 3. 實現功能

根據提示和前面章節的知識，實現所有功能。

### 4. 運行測試

```bash
npx hardhat test
```

確保所有測試通過。

### 5. 查看解答

如果遇到困難，可以查看 `solution/` 目錄中的參考解答。

但建議：
1. 先嘗試自己解決
2. 查看提示
3. 複習相關章節
4. 最後才看解答

### 6. 對比優化

將你的解答與參考解答對比：
- 邏輯是否更簡潔？
- Gas 消耗是否更少？
- 安全性是否更好？

---

## 額外挑戰

完成基本練習後，可以嘗試這些擴展：

### 練習 1 擴展

- [ ] 實現委託投票
- [ ] 添加投票權重
- [ ] 實現多選投票
- [ ] 添加投票結果查詢 API

### 練習 2 擴展

- [ ] 實現批量鑄造
- [ ] 添加白名單等級系統
- [ ] 實現可更新的元數據
- [ ] 添加二級市場版稅

### 練習 3 擴展

- [ ] 實現提案取消機制
- [ ] 添加緊急暫停功能
- [ ] 實現提案更新
- [ ] 添加鏈上投票權重計算

---

## 常見問題

### Q1: 測試一直失敗怎麼辦？

**A**: 
1. 檢查是否安裝了所有依賴
2. 確認 Hardhat 配置正確
3. 查看錯誤訊息，通常會指出具體問題
4. 使用 `console.log` 調試
5. 參考前面章節的範例

### Q2: 不知道從哪裡開始？

**A**:
1. 先看起始代碼中的 TODO 註釋
2. 從最簡單的函數開始實現
3. 一步一步，不要想一次完成所有功能
4. 參考前面章節的類似範例

### Q3: 我的實現和解答不一樣，是錯的嗎？

**A**:
不一定！解答只是參考，可能有多種正確實現。關鍵是：
- 功能正確
- 測試通過
- 安全性好
- 代碼清晰

### Q4: Gas 消耗比解答高很多怎麼辦？

**A**:
常見優化方向：
- 減少存儲操作（使用 memory/calldata）
- 打包變量（使用 struct）
- 避免重複計算
- 使用事件而不是存儲

---

## 提交你的解答

完成練習後，可以：

1. **自我評估**：使用評分標準檢查
2. **peer review**：與其他學習者討論
3. **創建 PR**：如果你有更好的解法，歡迎提交
4. **分享經驗**：在社區分享你的學習心得

---

## 獲取幫助

遇到問題時：

1. **複習相關章節**：
   - 第 1 章：基礎概念
   - 第 2 章：編碼流程
   - 第 3 章：簽名組件
   - 第 4 章：Hello World
   - 第 5 章：實戰範例
   - 第 6 章：安全性

2. **查看文檔**：
   - [Solidity 文檔](https://docs.soliditylang.org/)
   - [ethers.js 文檔](https://docs.ethers.org/)
   - [OpenZeppelin 文檔](https://docs.openzeppelin.com/)

3. **社區支持**：
   - Ethereum Stack Exchange
   - Discord 開發社區
   - GitHub Issues

---

## 完成獎勵 🎉

完成所有練習後，你將：

- ✅ 完全理解 EIP712 的原理和應用
- ✅ 能夠獨立實現複雜的簽名系統
- ✅ 掌握安全開發的最佳實踐
- ✅ 具備真實專案開發的能力

**恭喜你完成了整個 EIP712 學習課程！**

---

## 下一步

完成練習後，你可以：

1. **閱讀真實專案代碼**
   - Uniswap Permit2
   - OpenSea Seaport
   - Gnosis Safe

2. **參與開源專案**
   - 貢獻代碼
   - 報告 bug
   - 改進文檔

3. **構建自己的專案**
   - 應用所學知識
   - 創新性的應用場景
   - 與社區分享

---

[返回主目錄](../README.md)

