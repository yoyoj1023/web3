# Rust 所有權系統深度解析：從記憶體安全到高效編程的完整指南

**課程目標：** 學完本課程，您將能精準地掌握 Rust 所有權的核心機制，熟練運用借用檢查器避免記憶體錯誤，靈活運用切片實現安全的集合操作，最終建立起系統性的 Rust 記憶體安全編程思維。

### **第一單元：什麼是所有權？ (What is Ownership?)**

本單元將介紹 Rust 所有權系統的基本概念與運作規則。

*   **1.1 為何需要所有權？**
    *   探討常見的記憶體管理方式：手動管理（如 C/C++）與垃圾回收（如 Java, Python）。
    *   了解手動管理的風險（如：重複釋放、懸空指標）與 GC 的效能代價。
    *   引出 Rust 的第三條路：在編譯時期檢查記憶體安全的所有權系統。

*   **1.2 核心概念：堆疊 (Stack) 與堆積 (Heap)**
    *   解說兩種記憶體區域的差異與用途。
    *   堆疊：後進先出，存放大小固定的資料，存取快速。
    *   堆積：存放大小可能在執行時改變的資料，需要透過指標存取。
    *   透過範例說明，何種類型的資料會存放在哪個區域。

*   **1.3 所有權的三大黃金規則**
    *   **規則一：** Rust 中的每一個值都有一個擁有者（Owner）。
    *   **規則二：** 同一時間內，一個值只能有一個擁有者。
    *   **規則三：** 當擁有者離開作用域（Scope）時，該值會被自動丟棄（Dropped）。

*   **1.4 所有權轉移 (Move)**
    *   透過 `String` 型別的範例，展示變數賦值時發生的「所有權轉移」。
    *   解釋「淺拷貝」與「深拷貝」的概念，並說明 Rust 的「移動 (Move)」語義與之不同。
    *   探討函式傳遞參數時，所有權如何轉移，以及其對原變數的影響。

*   **1.5 複製特性 (Copy Trait)**
    *   介紹存放在堆疊上的簡單純量型別（如：整數、布林值）為何在賦值時是「複製」而非「移動」。
    *   說明 `Copy` Trait 的作用與限制。

---

### **第二單元：參考與借用 (References and Borrowing)**

在不轉移所有權的情況下，我們如何使用變數的值？本單元將介紹「借用」這個強大的概念。

*   **2.1 什麼是借用？**
    *   引出問題：如果每次傳遞都需要轉移所有權，將會非常不便。
    *   介紹「參考（Reference）」的概念：它允許你使用一個值，但不取得其所有權。
    *   語法介紹：如何使用 `&` 符號來建立參考。

*   **2.2 不可變借用 (Immutable Borrows)**
    *   學習如何建立與使用不可變參考。
    *   重點：在同一時間、同一個作用域內，可以擁有多個不可變參考。

*   **2.3 可變借用 (Mutable Borrows)**
    *   學習如何使用 `&mut` 來建立一個可變參考，以修改被借用的值。
    *   **核心限制：** 在任何給定時間，你只能擁有**一個**對特定資料的可變參考，且不能與任何不可變參考共存。
    *   透過範例理解此規則如何有效防止「資料競爭（Data Races）」。

*   **2.4 懸掛參考 (Dangling References)**
    *   了解什麼是懸掛參考（指向已經被釋放的記憶體）。
    *   展示 Rust 編譯器如何透過生命週期（Lifetimes）規則，在編譯時期就阻止懸掛參考的產生。

---

### **第三單元：切片型別 (The Slice Type)**

切片是另一種不擁有所有權的資料型別，它讓你能安全地引用一個集合（如字串或陣列）的部分連續序列。

*   **3.1 字串切片 (String Slices)**
    *   從一個問題開始：如何寫一個函式來回傳字串中的第一個單字？
    *   介紹字串切片的語法 `&str`，以及如何從 `String` 中建立切片。
    *   理解字串字面值（String Literals）本身就是一個切片。

*   **3.2 切片作為函式參數**
    *   學習如何將字串切片 `&str` 作為函式參數，讓函式更通用、更有彈性（可以同時接受 `String` 和 `&str`）。

*   **3.3 其他型別的切片**
    *   將切片的概念延伸到其他集合型別，如陣列（Array）和向量（Vector）。
    *   語法介紹：`&[T]`，例如 `&[i32]` 代表一個 i32 整數的切片。

---

**課程總結與練習：**

*   回顧所有權、借用、切片的核心概念與規則。
*   提供綜合練習題，例如：
    *   編寫一個函式，計算一個整數向量的總和，但不能取得向量的所有權。
    *   編寫一個函式，接收一個字串切片，並回傳其中第一個大寫字母的索引。
    *   分析一些有問題的程式碼，並解釋為何它們違反了所有權或借用規則。

透過這套課程的學習，您將對 Rust 如何管理記憶體有深刻的理解，並為後續學習泛型、生命週期、智慧指標等進階主題打下堅實的基礎。