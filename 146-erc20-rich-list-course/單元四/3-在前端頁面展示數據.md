# ç¬¬ä¸‰èª²ï¼šåœ¨å‰ç«¯é é¢å±•ç¤ºæ•¸æ“š

### ğŸ¯ å­¸ç¿’ç›®æ¨™

åœ¨é€™ä¸€èª²ä¸­ï¼Œæˆ‘å€‘å°‡ï¼š
- å°‡ `useTokenHolders` Hook æ•´åˆåˆ°å¯Œè±ªæ¦œé é¢
- å»ºç«‹ API è·¯ç”±ä¾†å®‰å…¨åœ°èª¿ç”¨ Alchemy API
- å„ªåŒ–æ•¸æ“šå±•ç¤ºå’Œç”¨æˆ¶é«”é©—
- å¯¦ä½œå¯¦æ™‚æ•¸æ“šæ›´æ–°å’ŒéŒ¯èª¤è™•ç†
- åŠ å…¥è¼‰å…¥å‹•ç•«å’Œç‹€æ…‹åé¥‹

### ğŸ”§ å»ºç«‹ API è·¯ç”±

é¦–å…ˆï¼Œæˆ‘å€‘éœ€è¦å»ºç«‹å¾Œç«¯ API è·¯ç”±ä¾†å®‰å…¨åœ°èª¿ç”¨ Alchemy APIï¼Œé¿å…åœ¨å‰ç«¯æš´éœ² API Keyã€‚

#### å»ºç«‹ä»£å¹£æŒæœ‰è€… API

å»ºç«‹ `packages/nextjs/app/api/token-holders/route.ts`ï¼š

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { isAddress } from 'viem';

// Alchemy API é…ç½®
const ALCHEMY_API_KEY = process.env.ALCHEMY_API_KEY;
const ALCHEMY_BASE_URL = 'https://opt-sepolia.g.alchemy.com/v2';

interface AlchemyError {
  error: {
    code: number;
    message: string;
  };
}

interface TokenHoldersRequest {
  contractAddress: string;
  pageSize?: number;
  pageKey?: string;
}

export async function POST(request: NextRequest) {
  try {
    // æª¢æŸ¥ API Key é…ç½®
    if (!ALCHEMY_API_KEY) {
      return NextResponse.json(
        { error: 'API Key not configured' },
        { status: 500 }
      );
    }

    // è§£æè«‹æ±‚æ•¸æ“š
    const body: TokenHoldersRequest = await request.json();
    const { contractAddress, pageSize = 1000, pageKey } = body;

    // é©—è­‰è¼¸å…¥
    if (!contractAddress) {
      return NextResponse.json(
        { error: 'ä»£å¹£åœ°å€ä¸èƒ½ç‚ºç©º' },
        { status: 400 }
      );
    }

    if (!isAddress(contractAddress)) {
      return NextResponse.json(
        { error: 'ç„¡æ•ˆçš„ä»¥å¤ªåŠåœ°å€æ ¼å¼' },
        { status: 400 }
      );
    }

    if (pageSize < 1 || pageSize > 1000) {
      return NextResponse.json(
        { error: 'é é¢å¤§å°å¿…é ˆåœ¨ 1-1000 ä¹‹é–“' },
        { status: 400 }
      );
    }

    // æº–å‚™ API è«‹æ±‚åƒæ•¸
    const params = new URLSearchParams({
      contractAddress: contractAddress.toLowerCase(),
      withTokenBalances: 'true',
      pageSize: pageSize.toString(),
    });

    if (pageKey) {
      params.append('pageKey', pageKey);
    }

    // èª¿ç”¨ Alchemy API
    const alchemyUrl = `${ALCHEMY_BASE_URL}/${ALCHEMY_API_KEY}/getOwnersForContract?${params}`;
    
    const response = await fetch(alchemyUrl, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
      },
    });

    if (!response.ok) {
      const errorData: AlchemyError = await response.json();
      
      // è½‰æ› Alchemy éŒ¯èª¤ç‚ºå‹å–„è¨Šæ¯
      const friendlyMessage = formatAlchemyError(response.status, errorData);
      
      return NextResponse.json(
        { error: friendlyMessage },
        { status: response.status }
      );
    }

    const data = await response.json();

    // é©—è­‰å›æ‡‰æ ¼å¼
    if (!data.owners || !Array.isArray(data.owners)) {
      return NextResponse.json(
        { error: 'API å›æ‡‰æ ¼å¼ç•°å¸¸' },
        { status: 500 }
      );
    }

    return NextResponse.json(data);

  } catch (error) {
    console.error('Token holders API error:', error);
    
    return NextResponse.json(
      { error: 'ç²å–ä»£å¹£æŒæœ‰è€…æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤' },
      { status: 500 }
    );
  }
}

/**
 * æ ¼å¼åŒ– Alchemy API éŒ¯èª¤è¨Šæ¯
 */
function formatAlchemyError(status: number, errorData?: AlchemyError): string {
  switch (status) {
    case 400:
      return 'è«‹æ±‚åƒæ•¸éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ä»£å¹£åœ°å€æ ¼å¼';
    case 401:
      return 'API èªè­‰å¤±æ•—ï¼Œè«‹è¯çµ¡ç®¡ç†å“¡';
    case 403:
      return 'API è«‹æ±‚é¡åº¦å·²ç”¨å®Œï¼Œè«‹ç¨å¾Œå†è©¦';
    case 404:
      return 'æ‰¾ä¸åˆ°æŒ‡å®šçš„ä»£å¹£åˆç´„';
    case 429:
      return 'è«‹æ±‚éæ–¼é »ç¹ï¼Œè«‹ç¨å¾Œå†è©¦';
    case 500:
    case 502:
    case 503:
      return 'æœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦';
    default:
      return errorData?.error?.message || 'ç™¼ç”Ÿæœªé æœŸçš„éŒ¯èª¤';
  }
}
```

#### å»ºç«‹ä»£å¹£å…ƒæ•¸æ“š API

å»ºç«‹ `packages/nextjs/app/api/token-metadata/route.ts`ï¼š

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { isAddress } from 'viem';

const ALCHEMY_API_KEY = process.env.ALCHEMY_API_KEY;
const ALCHEMY_BASE_URL = 'https://opt-sepolia.g.alchemy.com/v2';

interface TokenMetadataRequest {
  contractAddress: string;
}

export async function POST(request: NextRequest) {
  try {
    if (!ALCHEMY_API_KEY) {
      return NextResponse.json(
        { error: 'API Key not configured' },
        { status: 500 }
      );
    }

    const body: TokenMetadataRequest = await request.json();
    const { contractAddress } = body;

    // é©—è­‰è¼¸å…¥
    if (!contractAddress || !isAddress(contractAddress)) {
      return NextResponse.json(
        { error: 'ç„¡æ•ˆçš„ä»£å¹£åœ°å€' },
        { status: 400 }
      );
    }

    // èª¿ç”¨ Alchemy API
    const params = new URLSearchParams({
      contractAddress: contractAddress.toLowerCase(),
    });

    const alchemyUrl = `${ALCHEMY_BASE_URL}/${ALCHEMY_API_KEY}/getTokenMetadata?${params}`;
    
    const response = await fetch(alchemyUrl, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
      },
    });

    if (!response.ok) {
      const errorData = await response.json();
      const friendlyMessage = formatAlchemyError(response.status, errorData);
      
      return NextResponse.json(
        { error: friendlyMessage },
        { status: response.status }
      );
    }

    const data = await response.json();

    // æ¨™æº–åŒ–å›æ‡‰æ ¼å¼
    const tokenData = {
      name: data.name || 'Unknown Token',
      symbol: data.symbol || 'UNKNOWN',
      decimals: data.decimals || 18,
      totalSupply: data.totalSupply || '0',
      contractAddress: contractAddress.toLowerCase(),
    };

    return NextResponse.json(tokenData);

  } catch (error) {
    console.error('Token metadata API error:', error);
    
    return NextResponse.json(
      { error: 'ç²å–ä»£å¹£è³‡è¨Šæ™‚ç™¼ç”ŸéŒ¯èª¤' },
      { status: 500 }
    );
  }
}

function formatAlchemyError(status: number, errorData?: any): string {
  switch (status) {
    case 400:
      return 'è«‹æ±‚åƒæ•¸éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ä»£å¹£åœ°å€æ ¼å¼';
    case 401:
      return 'API èªè­‰å¤±æ•—ï¼Œè«‹è¯çµ¡ç®¡ç†å“¡';
    case 404:
      return 'æ‰¾ä¸åˆ°æŒ‡å®šçš„ä»£å¹£åˆç´„æˆ–è©²åˆç´„ä¸æ˜¯æœ‰æ•ˆçš„ ERC20 ä»£å¹£';
    case 429:
      return 'è«‹æ±‚éæ–¼é »ç¹ï¼Œè«‹ç¨å¾Œå†è©¦';
    case 500:
      return 'æœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦';
    default:
      return errorData?.error?.message || 'ç™¼ç”Ÿæœªé æœŸçš„éŒ¯èª¤';
  }
}
```

### ğŸ”„ æ›´æ–° useTokenHolders Hook

æ›´æ–°æˆ‘å€‘çš„ Hook ä»¥ä½¿ç”¨æ–°çš„ API è·¯ç”±ï¼š

```typescript
// hooks/utils/alchemyApi.ts (æ›´æ–°ç‰ˆæœ¬)
export class AlchemyApi {
  /**
   * é€šé Next.js API è·¯ç”±ç²å–ä»£å¹£æŒæœ‰è€…
   */
  async getTokenHolders(
    contractAddress: string,
    options: {
      pageSize?: number;
      pageKey?: string;
    } = {}
  ): Promise<AlchemyResponse> {
    const { pageSize = 1000, pageKey } = options;

    try {
      const response = await fetch('/api/token-holders', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contractAddress,
          pageSize,
          pageKey,
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new AlchemyApiError(
          errorData.error || 'API request failed',
          response.status
        );
      }

      const data = await response.json();
      return data;
    } catch (error) {
      if (error instanceof AlchemyApiError) {
        throw error;
      }
      
      throw new AlchemyApiError(
        'Failed to fetch token holders',
        undefined,
        error
      );
    }
  }

  /**
   * é€šé Next.js API è·¯ç”±ç²å–ä»£å¹£å…ƒæ•¸æ“š
   */
  async getTokenMetadata(contractAddress: string): Promise<TokenData> {
    try {
      const response = await fetch('/api/token-metadata', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contractAddress,
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new AlchemyApiError(
          errorData.error || 'API request failed',
          response.status
        );
      }

      const data = await response.json();
      return data;
    } catch (error) {
      if (error instanceof AlchemyApiError) {
        throw error;
      }
      
      throw new AlchemyApiError(
        'Failed to fetch token metadata',
        undefined,
        error
      );
    }
  }

  /**
   * ç²å–æ‰€æœ‰ä»£å¹£æŒæœ‰è€…ï¼ˆè™•ç†åˆ†é ï¼‰
   */
  async getAllTokenHolders(contractAddress: string): Promise<AlchemyResponse> {
    let allOwners: any[] = [];
    let pageKey: string | null = null;
    let totalCount = 0;

    do {
      const response = await this.getTokenHolders(contractAddress, {
        pageKey: pageKey || undefined,
        pageSize: 1000,
      });

      allOwners = allOwners.concat(response.owners);
      pageKey = response.pageKey;
      totalCount = response.totalCount;

      // é¿å…è«‹æ±‚éæ–¼é »ç¹
      if (pageKey) {
        await this.delay(200);
      }

      // å®‰å…¨æª¢æŸ¥ï¼šé¿å…ç„¡é™å¾ªç’°
      if (allOwners.length > 10000) {
        console.warn('Token holders count exceeds 10,000, stopping pagination');
        break;
      }

    } while (pageKey);

    return {
      owners: allOwners,
      pageKey: null,
      totalCount: allOwners.length
    };
  }

  private delay(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

// å»ºç«‹é è¨­å¯¦ä¾‹
export const alchemyApi = new AlchemyApi();
```

### ğŸ¨ æ›´æ–°å¯Œè±ªæ¦œé é¢

ç¾åœ¨è®“æˆ‘å€‘æ›´æ–°å¯Œè±ªæ¦œé é¢ä»¥ä½¿ç”¨æ–°çš„ Hookï¼š

```typescript
// app/rich-list/page.tsx (æ›´æ–°ç‰ˆæœ¬)
"use client";

import { useState } from "react";
import { NextPage } from "next";
import { AddressInput, IntegerInput } from "~~/components/scaffold-alchemy";
import { useTokenHolders } from "~~/hooks/useTokenHolders";
import { TokenInfoCard } from "./_components/TokenInfoCard";
import { RichListTable } from "./_components/RichListTable";
import { LoadingSpinner } from "./_components/LoadingSpinner";
import { ErrorMessage } from "./_components/ErrorMessage";
import { StatsCards } from "./_components/StatsCards";
import { SearchHistory } from "./_components/SearchHistory";
import { isAddress } from "viem";

const RichListPage: NextPage = () => {
  // è¡¨å–®ç‹€æ…‹
  const [tokenAddress, setTokenAddress] = useState<string>("");
  const [pageSize, setPageSize] = useState<bigint>(BigInt(20));
  
  // æœå°‹æ­·å²
  const [searchHistory, setSearchHistory] = useState<string[]>([]);
  
  // ä½¿ç”¨æˆ‘å€‘çš„è‡ªå®šç¾© Hook
  const {
    tokenData,
    holders,
    totalHolders,
    isLoading,
    error,
    stats,
    fetchTokenHolders,
    refetch,
    clearData,
    findHolder,
  } = useTokenHolders();

  // è™•ç†æœå°‹
  const handleSearch = async () => {
    if (!isAddress(tokenAddress)) {
      alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„ä»¥å¤ªåŠåœ°å€");
      return;
    }
    
    try {
      await fetchTokenHolders(tokenAddress, {
        withCache: true,
        forceRefresh: false,
      });
      
      // æ·»åŠ åˆ°æœå°‹æ­·å²
      setSearchHistory(prev => {
        const newHistory = [tokenAddress, ...prev.filter(addr => addr !== tokenAddress)];
        return newHistory.slice(0, 5); // åªä¿ç•™æœ€è¿‘ 5 å€‹
      });
    } catch (error) {
      console.error('Search failed:', error);
    }
  };

  // è™•ç†æ­·å²æœå°‹
  const handleHistorySearch = async (address: string) => {
    setTokenAddress(address);
    await fetchTokenHolders(address);
  };

  // è™•ç†åœ°å€æœå°‹
  const handleAddressSearch = () => {
    const searchAddress = prompt('è¼¸å…¥è¦æœå°‹çš„æŒæœ‰è€…åœ°å€:');
    if (searchAddress && isAddress(searchAddress)) {
      const holder = findHolder(searchAddress);
      if (holder) {
        alert(`æ‰¾åˆ°æŒæœ‰è€…ï¼\næ’å: #${holder.rank}\né¤˜é¡: ${holder.balanceFormatted} ${tokenData?.symbol}\nä½”æ¯”: ${holder.percentage.toFixed(4)}%`);
      } else {
        alert('æœªæ‰¾åˆ°è©²åœ°å€çš„æŒæœ‰è¨˜éŒ„');
      }
    } else if (searchAddress) {
      alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ä»¥å¤ªåŠåœ°å€');
    }
  };

  // è¨ˆç®—é¡¯ç¤ºçš„æŒæœ‰è€…
  const displayedHolders = holders.slice(0, Number(pageSize));

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50">
      <div className="container mx-auto px-4 py-8 max-w-7xl">
        
        {/* é é¢æ¨™é¡Œ */}
        <div className="text-center mb-12">
          <h1 className="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
            ğŸ† ERC20 å¯Œè±ªæ¦œæŸ¥è©¢
          </h1>
          <p className="text-lg text-gray-600 max-w-2xl mx-auto">
            è¼¸å…¥ä»»ä½• ERC20 ä»£å¹£åˆç´„åœ°å€ï¼Œå³æ™‚æŸ¥çœ‹ä»£å¹£æŒæœ‰è€…æ’è¡Œæ¦œã€‚
            æ”¯æ´æ‰€æœ‰ Optimism Sepolia ç¶²è·¯ä¸Šçš„ä»£å¹£ã€‚
          </p>
        </div>

        {/* æœå°‹å€åŸŸ */}
        <div className="bg-white rounded-2xl shadow-xl p-8 mb-8">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-2xl font-semibold text-gray-800">
              ğŸ” ä»£å¹£æŸ¥è©¢
            </h2>
            
            {/* æ“ä½œæŒ‰éˆ• */}
            <div className="flex gap-2">
              <button
                onClick={refetch}
                disabled={!tokenData || isLoading}
                className="bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg text-sm transition-colors"
              >
                ğŸ”„ é‡æ–°æ•´ç†
              </button>
              <button
                onClick={clearData}
                disabled={isLoading}
                className="bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white px-4 py-2 rounded-lg text-sm transition-colors"
              >
                ğŸ—‘ï¸ æ¸…é™¤
              </button>
              <button
                onClick={handleAddressSearch}
                disabled={holders.length === 0 || isLoading}
                className="bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-4 py-2 rounded-lg text-sm transition-colors"
              >
                ğŸ” æœå°‹æŒæœ‰è€…
              </button>
            </div>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            {/* ä»£å¹£åœ°å€è¼¸å…¥ */}
            <div className="md:col-span-2">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                ä»£å¹£åˆç´„åœ°å€
              </label>
              <AddressInput
                value={tokenAddress}
                onChange={setTokenAddress}
                placeholder="0x1234567890abcdef..."
                className="w-full"
                disabled={isLoading}
              />
              <p className="text-xs text-gray-500 mt-1">
                è«‹è¼¸å…¥æœ‰æ•ˆçš„ ERC20 ä»£å¹£åˆç´„åœ°å€
              </p>
            </div>

            {/* é¡¯ç¤ºæ•¸é‡ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                é¡¯ç¤ºæ•¸é‡
              </label>
              <IntegerInput
                value={pageSize}
                onChange={setPageSize}
                placeholder="20"
                className="w-full"
                disabled={isLoading}
              />
              <p className="text-xs text-gray-500 mt-1">
                1-100 å€‹é …ç›®
              </p>
            </div>

            {/* æœå°‹æŒ‰éˆ• */}
            <div className="flex items-end">
              <button
                onClick={handleSearch}
                disabled={!tokenAddress || isLoading}
                className="
                  w-full h-12
                  bg-gradient-to-r from-blue-600 to-purple-600
                  hover:from-blue-700 hover:to-purple-700
                  disabled:from-gray-400 disabled:to-gray-500
                  disabled:cursor-not-allowed
                  text-white font-semibold
                  rounded-xl
                  transition-all duration-300
                  transform hover:scale-105 disabled:hover:scale-100
                  shadow-lg hover:shadow-xl
                "
              >
                {isLoading ? (
                  <div className="flex items-center justify-center gap-2">
                    <div className="animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"></div>
                    æŸ¥è©¢ä¸­...
                  </div>
                ) : (
                  "ğŸš€ æŸ¥è©¢å¯Œè±ªæ¦œ"
                )}
              </button>
            </div>
          </div>

          {/* æœå°‹æ­·å² */}
          {searchHistory.length > 0 && (
            <SearchHistory
              history={searchHistory}
              onSelect={handleHistorySearch}
              isLoading={isLoading}
            />
          )}
        </div>

        {/* éŒ¯èª¤è¨Šæ¯ */}
        {error && (
          <ErrorMessage 
            message={error}
            onRetry={refetch}
            className="mb-8"
          />
        )}

        {/* è¼‰å…¥ç‹€æ…‹ */}
        {isLoading && (
          <LoadingSpinner 
            message="æ­£åœ¨ç²å–å¯Œè±ªæ¦œæ•¸æ“š..."
            details="é€™å¯èƒ½éœ€è¦å¹¾ç§’é˜æ™‚é–“ï¼Œè«‹è€å¿ƒç­‰å€™"
            className="mb-8"
          />
        )}

        {/* ä»£å¹£è³‡è¨Šå¡ç‰‡ */}
        {tokenData && !error && (
          <TokenInfoCard 
            tokenData={tokenData}
            totalHolders={totalHolders}
            className="mb-8"
          />
        )}

        {/* çµ±è¨ˆè³‡è¨Šå¡ç‰‡ */}
        {holders.length > 0 && !isLoading && !error && (
          <StatsCards 
            stats={stats}
            tokenSymbol={tokenData?.symbol || 'TOKEN'}
            className="mb-8"
          />
        )}

        {/* å¯Œè±ªæ¦œè¡¨æ ¼ */}
        {holders.length > 0 && !isLoading && !error && (
          <RichListTable
            holders={displayedHolders}
            tokenSymbol={tokenData?.symbol || "TOKEN"}
            totalSupply={tokenData?.totalSupply}
            showRanking={true}
            className="mb-8"
          />
        )}

        {/* é¡¯ç¤ºæ›´å¤šæŒ‰éˆ• */}
        {holders.length > Number(pageSize) && (
          <div className="text-center">
            <button
              onClick={() => setPageSize(prev => prev + BigInt(20))}
              className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-medium transition-colors"
            >
              é¡¯ç¤ºæ›´å¤šæŒæœ‰è€… ({holders.length - Number(pageSize)} å€‹å‰©é¤˜)
            </button>
          </div>
        )}

        {/* ç©ºç‹€æ…‹ */}
        {holders.length === 0 && !isLoading && !error && tokenAddress && (
          <div className="text-center py-16">
            <div className="text-6xl mb-4">ğŸ”</div>
            <h3 className="text-xl font-semibold text-gray-700 mb-2">
              æœªæ‰¾åˆ°æŒæœ‰è€…æ•¸æ“š
            </h3>
            <p className="text-gray-500 mb-4">
              è«‹ç¢ºèªä»£å¹£åœ°å€æ­£ç¢ºï¼Œæˆ–è©²ä»£å¹£å¯èƒ½æ²’æœ‰æŒæœ‰è€…ã€‚
            </p>
            <button
              onClick={() => setTokenAddress("")}
              className="text-blue-600 hover:text-blue-700 font-medium"
            >
              é‡æ–°è¼¸å…¥åœ°å€
            </button>
          </div>
        )}

        {/* åˆå§‹ç‹€æ…‹ */}
        {!tokenAddress && !isLoading && (
          <div className="text-center py-16">
            <div className="text-6xl mb-4">ğŸ¯</div>
            <h3 className="text-xl font-semibold text-gray-700 mb-2">
              é–‹å§‹æŸ¥è©¢å¯Œè±ªæ¦œ
            </h3>
            <p className="text-gray-500 mb-6">
              è¼¸å…¥ ERC20 ä»£å¹£åˆç´„åœ°å€ï¼ŒæŸ¥çœ‹æŒæœ‰è€…æ’è¡Œæ¦œã€‚
            </p>
            
            {/* ç¯„ä¾‹åœ°å€ */}
            <div className="bg-gray-50 rounded-lg p-4 max-w-md mx-auto">
              <p className="text-sm text-gray-600 mb-2">è©¦è©¦é€™äº›ç¯„ä¾‹åœ°å€ï¼š</p>
              <div className="space-y-2">
                <button
                  onClick={() => setTokenAddress("0x1234567890123456789012345678901234567890")}
                  className="block w-full text-left font-mono text-sm text-blue-600 hover:text-blue-700 p-2 rounded hover:bg-blue-50"
                >
                  0x1234...7890 (ç¯„ä¾‹ä»£å¹£)
                </button>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default RichListPage;
```

### ğŸ“Š æ–°å¢çµ±è¨ˆå¡ç‰‡çµ„ä»¶

å»ºç«‹ `app/rich-list/_components/StatsCards.tsx`ï¼š

```typescript
interface StatsCardsProps {
  stats: {
    totalHolders: number;
    totalBalance: number;
    averageBalance: number;
    medianBalance: number;
    top10Percentage: number;
  };
  tokenSymbol: string;
  className?: string;
}

export function StatsCards({ stats, tokenSymbol, className = "" }: StatsCardsProps) {
  const formatNumber = (num: number, decimals: number = 2) => {
    if (num >= 1000000) {
      return `${(num / 1000000).toFixed(decimals)}M`;
    } else if (num >= 1000) {
      return `${(num / 1000).toFixed(decimals)}K`;
    }
    return num.toFixed(decimals);
  };

  const statsData = [
    {
      title: "ç¸½æŒæœ‰è€…",
      value: stats.totalHolders.toLocaleString(),
      icon: "ğŸ‘¥",
      color: "bg-blue-500",
      bgColor: "bg-blue-50",
      textColor: "text-blue-700"
    },
    {
      title: "å¹³å‡æŒæœ‰é‡",
      value: `${formatNumber(stats.averageBalance)} ${tokenSymbol}`,
      icon: "ğŸ“Š",
      color: "bg-green-500",
      bgColor: "bg-green-50",
      textColor: "text-green-700"
    },
    {
      title: "ä¸­ä½æ•¸æŒæœ‰é‡",
      value: `${formatNumber(stats.medianBalance)} ${tokenSymbol}`,
      icon: "ğŸ“ˆ",
      color: "bg-purple-500",
      bgColor: "bg-purple-50",
      textColor: "text-purple-700"
    },
    {
      title: "å‰10åä½”æ¯”",
      value: `${stats.top10Percentage.toFixed(1)}%`,
      icon: "ğŸ†",
      color: "bg-orange-500",
      bgColor: "bg-orange-50",
      textColor: "text-orange-700"
    }
  ];

  return (
    <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 ${className}`}>
      {statsData.map((stat, index) => (
        <div key={index} className={`${stat.bgColor} rounded-xl p-6 border border-opacity-20`}>
          <div className="flex items-center justify-between mb-4">
            <div className={`w-12 h-12 ${stat.color} rounded-lg flex items-center justify-center text-white text-xl`}>
              {stat.icon}
            </div>
            <div className="text-right">
              <div className={`text-2xl font-bold ${stat.textColor}`}>
                {stat.value}
              </div>
            </div>
          </div>
          <div className={`text-sm font-medium ${stat.textColor} opacity-80`}>
            {stat.title}
          </div>
        </div>
      ))}
    </div>
  );
}
```

### ğŸ•’ æ–°å¢æœå°‹æ­·å²çµ„ä»¶

å»ºç«‹ `app/rich-list/_components/SearchHistory.tsx`ï¼š

```typescript
interface SearchHistoryProps {
  history: string[];
  onSelect: (address: string) => void;
  isLoading: boolean;
  className?: string;
}

export function SearchHistory({ 
  history, 
  onSelect, 
  isLoading, 
  className = "" 
}: SearchHistoryProps) {
  if (history.length === 0) return null;

  return (
    <div className={`border-t pt-4 ${className}`}>
      <p className="text-sm text-gray-600 mb-3">æœ€è¿‘æœå°‹:</p>
      <div className="flex flex-wrap gap-2">
        {history.map((address, index) => (
          <button
            key={address}
            onClick={() => onSelect(address)}
            disabled={isLoading}
            className="
              bg-gray-100 hover:bg-gray-200 
              disabled:bg-gray-50 disabled:cursor-not-allowed
              text-gray-700 disabled:text-gray-400
              px-3 py-1 rounded-full text-xs font-mono
              transition-colors duration-200
              flex items-center gap-2
            "
          >
            <span className="text-gray-400">#{index + 1}</span>
            {address.slice(0, 6)}...{address.slice(-4)}
          </button>
        ))}
      </div>
    </div>
  );
}
```

### ğŸ”„ å„ªåŒ–è¼‰å…¥å’ŒéŒ¯èª¤çµ„ä»¶

æ›´æ–° `LoadingSpinner.tsx`ï¼š

```typescript
interface LoadingSpinnerProps {
  message?: string;
  details?: string;
  className?: string;
}

export function LoadingSpinner({ 
  message = "è¼‰å…¥ä¸­...", 
  details,
  className = "" 
}: LoadingSpinnerProps) {
  return (
    <div className={`bg-white rounded-2xl shadow-xl p-12 text-center ${className}`}>
      <div className="flex flex-col items-center gap-6">
        {/* å‹•ç•«è¼‰å…¥å™¨ */}
        <div className="relative">
          <div className="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
          <div className="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin absolute top-2 left-2 animate-pulse"></div>
        </div>
        
        <div className="space-y-2">
          <h3 className="text-lg font-semibold text-gray-700">
            {message}
          </h3>
          {details && (
            <p className="text-gray-500 text-sm max-w-md">
              {details}
            </p>
          )}
        </div>

        {/* é€²åº¦æŒ‡ç¤ºå™¨ */}
        <div className="w-64 bg-gray-200 rounded-full h-2">
          <div className="bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full animate-pulse" style={{width: '60%'}}></div>
        </div>
      </div>
    </div>
  );
}
```

### ğŸ§ª æ–°å¢åµéŒ¯å·¥å…·

å»ºç«‹åµéŒ¯çµ„ä»¶ `app/rich-list/_components/DebugPanel.tsx`ï¼š

```typescript
import { useState } from 'react';
import { TokenData, TokenHolder } from '~~/hooks/useTokenHolders';

interface DebugPanelProps {
  tokenData: TokenData | null;
  holders: TokenHolder[];
  isLoading: boolean;
  error: string | null;
}

export function DebugPanel({ tokenData, holders, isLoading, error }: DebugPanelProps) {
  const [isOpen, setIsOpen] = useState(false);

  // åªåœ¨é–‹ç™¼ç’°å¢ƒé¡¯ç¤º
  if (process.env.NODE_ENV !== 'development') {
    return null;
  }

  return (
    <div className="fixed bottom-4 right-4 z-50">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="bg-gray-800 text-white p-2 rounded-full shadow-lg hover:bg-gray-700"
      >
        ğŸ”§
      </button>
      
      {isOpen && (
        <div className="absolute bottom-12 right-0 w-80 bg-white rounded-lg shadow-xl border p-4 max-h-96 overflow-y-auto">
          <h3 className="font-bold text-gray-800 mb-3">Debug Panel</h3>
          
          <div className="space-y-3 text-sm">
            <div>
              <strong>Loading:</strong> {isLoading ? 'âœ…' : 'âŒ'}
            </div>
            
            <div>
              <strong>Error:</strong> {error || 'ç„¡'}
            </div>
            
            <div>
              <strong>Token Data:</strong> {tokenData ? 'âœ…' : 'âŒ'}
              {tokenData && (
                <div className="ml-2 text-xs text-gray-600">
                  <div>Name: {tokenData.name}</div>
                  <div>Symbol: {tokenData.symbol}</div>
                  <div>Decimals: {tokenData.decimals}</div>
                </div>
              )}
            </div>
            
            <div>
              <strong>Holders Count:</strong> {holders.length}
            </div>
            
            {holders.length > 0 && (
              <div>
                <strong>Top Holder:</strong>
                <div className="ml-2 text-xs text-gray-600 font-mono">
                  {holders[0].address.slice(0, 10)}...
                </div>
                <div className="ml-2 text-xs text-gray-600">
                  Balance: {holders[0].balanceFormatted}
                </div>
              </div>
            )}
            
            <div>
              <strong>Cache Stats:</strong>
              <button
                onClick={() => {
                  // é€™è£¡å¯ä»¥æ·»åŠ æ¸…é™¤å¿«å–çš„é‚è¼¯
                  console.log('Cache cleared');
                }}
                className="ml-2 text-xs bg-red-100 text-red-600 px-2 py-1 rounded"
              >
                Clear Cache
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
```

### ğŸ¨ å„ªåŒ–ç”¨æˆ¶é«”é©—

#### 1. æ·»åŠ éµç›¤å¿«æ·éµæ”¯æ´

```typescript
// åœ¨ä¸»é é¢çµ„ä»¶ä¸­æ·»åŠ 
useEffect(() => {
  const handleKeyDown = (event: KeyboardEvent) => {
    // Ctrl/Cmd + Enter åŸ·è¡Œæœå°‹
    if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
      if (tokenAddress && !isLoading) {
        handleSearch();
      }
    }
    
    // Escape æ¸…é™¤æ•¸æ“š
    if (event.key === 'Escape') {
      clearData();
    }
  };

  window.addEventListener('keydown', handleKeyDown);
  return () => window.removeEventListener('keydown', handleKeyDown);
}, [tokenAddress, isLoading, handleSearch, clearData]);
```

#### 2. æ·»åŠ è¤‡è£½åŠŸèƒ½

```typescript
const copyToClipboard = async (text: string) => {
  try {
    await navigator.clipboard.writeText(text);
    // é¡¯ç¤ºæˆåŠŸæç¤º
    alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
  } catch (error) {
    console.error('è¤‡è£½å¤±æ•—:', error);
  }
};
```

#### 3. æ·»åŠ åˆ†äº«åŠŸèƒ½

```typescript
const shareResults = async () => {
  if (!tokenData) return;
  
  const shareData = {
    title: `${tokenData.name} (${tokenData.symbol}) å¯Œè±ªæ¦œ`,
    text: `æŸ¥çœ‹ ${tokenData.name} ä»£å¹£çš„æŒæœ‰è€…æ’è¡Œæ¦œï¼Œå…±æœ‰ ${totalHolders} å€‹æŒæœ‰è€…ã€‚`,
    url: `${window.location.origin}/rich-list?token=${tokenData.contractAddress}`,
  };

  try {
    if (navigator.share) {
      await navigator.share(shareData);
    } else {
      // å‚™ç”¨æ–¹æ¡ˆï¼šè¤‡è£½é€£çµ
      await copyToClipboard(shareData.url);
    }
  } catch (error) {
    console.error('åˆ†äº«å¤±æ•—:', error);
  }
};
```

### âœ… å°çµ

åœ¨é€™ä¸€èª²ä¸­ï¼Œæˆ‘å€‘æˆåŠŸå°‡ API æ•´åˆåˆ°å‰ç«¯é é¢ï¼š

âœ… **å®‰å…¨çš„ API æ¶æ§‹**
- å»ºç«‹ Next.js API è·¯ç”±ä¿è­· API Key
- å¯¦ä½œéŒ¯èª¤è™•ç†å’Œè¼¸å…¥é©—è­‰
- å‹å–„çš„éŒ¯èª¤è¨Šæ¯è½‰æ›

âœ… **å®Œæ•´çš„å‰ç«¯æ•´åˆ**
- æ›´æ–° Hook ä½¿ç”¨æ–°çš„ API è·¯ç”±
- å„ªåŒ–é é¢çµ„ä»¶å’Œç”¨æˆ¶é«”é©—
- æ·»åŠ æœå°‹æ­·å²å’Œçµ±è¨ˆè³‡è¨Š

âœ… **å¢å¼·çš„ç”¨æˆ¶é«”é©—**
- è¼‰å…¥å‹•ç•«å’Œç‹€æ…‹åé¥‹
- éµç›¤å¿«æ·éµæ”¯æ´
- åµéŒ¯å·¥å…·å’ŒéŒ¯èª¤è™•ç†

âœ… **æ€§èƒ½å„ªåŒ–**
- æ™ºèƒ½å¿«å–æ©Ÿåˆ¶
- åˆ†é æ•¸æ“šè™•ç†
- è«‹æ±‚é˜²æŠ–å’Œç¯€æµ

åœ¨ä¸‹å€‹å–®å…ƒä¸­ï¼Œæˆ‘å€‘å°‡å¯¦ä½œé€²éšçš„åˆ†é åŠŸèƒ½ï¼Œè®“ç”¨æˆ¶èƒ½å¤ æ›´å¥½åœ°ç€è¦½å¤§é‡çš„æŒæœ‰è€…æ•¸æ“šï¼

---

**æº–å‚™å¥½å¯¦ä½œæ›´å¼·å¤§çš„åˆ†é åŠŸèƒ½äº†å—ï¼Ÿ** ğŸ“„
