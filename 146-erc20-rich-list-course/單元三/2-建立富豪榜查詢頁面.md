# 第二課：建立富豪榜查詢頁面

### 🎯 學習目標

在這一課中，我們將：
- 建立富豪榜查詢頁面的完整結構
- 實作用戶輸入界面和狀態管理
- 整合 Alchemy API 進行數據獲取
- 建立美觀的數據展示界面
- 實現錯誤處理和載入狀態

### 🏗️ 頁面架構設計

#### 1. 建立頁面路由

首先，在 Next.js 中建立新的頁面路由：

```bash
# 進入前端目錄
cd packages/nextjs

# 建立富豪榜頁面
mkdir -p app/rich-list
touch app/rich-list/page.tsx
```

#### 2. 頁面結構規劃

```
Rich List Page
├── Header Section          # 標題和說明
├── Search Form            # 代幣地址輸入表單
│   ├── Token Address Input
│   ├── Page Size Selector
│   └── Search Button
├── Token Info Display     # 代幣基本資訊
├── Rich List Table        # 富豪榜數據表格
│   ├── Rank Column
│   ├── Address Column
│   ├── Balance Column
│   └── Percentage Column
├── Pagination Controls    # 分頁控制
└── Loading & Error States # 載入和錯誤狀態
```

### 📝 實作頁面組件

#### 1. 主頁面組件

建立 `app/rich-list/page.tsx`：

```tsx
"use client";

import { useState } from "react";
import { NextPage } from "next";
import { AddressInput, IntegerInput } from "~~/components/scaffold-alchemy";
import { TokenInfoCard } from "./_components/TokenInfoCard";
import { RichListTable } from "./_components/RichListTable";
import { PaginationControls } from "./_components/PaginationControls";
import { LoadingSpinner } from "./_components/LoadingSpinner";
import { ErrorMessage } from "./_components/ErrorMessage";
import { useTokenHolders } from "~~/hooks/useTokenHolders";
import { isAddress } from "viem";

const RichListPage: NextPage = () => {
  // 狀態管理
  const [tokenAddress, setTokenAddress] = useState<string>("");
  const [pageSize, setPageSize] = useState<bigint>(BigInt(10));
  const [currentPage, setCurrentPage] = useState<number>(1);
  
  // 自定義 Hook 用於數據獲取
  const {
    data: tokenData,
    holders,
    totalHolders,
    isLoading,
    error,
    fetchTokenHolders,
  } = useTokenHolders();

  // 處理搜尋
  const handleSearch = async () => {
    if (!isAddress(tokenAddress)) {
      alert("請輸入有效的以太坊地址");
      return;
    }
    
    setCurrentPage(1);
    await fetchTokenHolders(tokenAddress, Number(pageSize));
  };

  // 處理分頁
  const handlePageChange = (page: number) => {
    setCurrentPage(page);
  };

  // 計算分頁數據
  const totalPages = Math.ceil(totalHolders / Number(pageSize));
  const startIndex = (currentPage - 1) * Number(pageSize);
  const endIndex = startIndex + Number(pageSize);
  const currentHolders = holders.slice(startIndex, endIndex);

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50">
      <div className="container mx-auto px-4 py-8 max-w-6xl">
        
        {/* 頁面標題 */}
        <div className="text-center mb-12">
          <h1 className="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
            🏆 ERC20 富豪榜查詢
          </h1>
          <p className="text-lg text-gray-600 max-w-2xl mx-auto">
            輸入任何 ERC20 代幣合約地址，即時查看代幣持有者排行榜。
            支援所有 Optimism Sepolia 網路上的代幣。
          </p>
        </div>

        {/* 搜尋表單 */}
        <div className="bg-white rounded-2xl shadow-xl p-8 mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-6">
            🔍 代幣查詢
          </h2>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {/* 代幣地址輸入 */}
            <div className="md:col-span-2">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                代幣合約地址
              </label>
              <AddressInput
                value={tokenAddress}
                onChange={setTokenAddress}
                placeholder="0x1234567890abcdef..."
                className="w-full"
                disabled={isLoading}
              />
              <p className="text-xs text-gray-500 mt-1">
                請輸入有效的 ERC20 代幣合約地址
              </p>
            </div>

            {/* 每頁顯示數量 */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                每頁顯示
              </label>
              <IntegerInput
                value={pageSize}
                onChange={setPageSize}
                placeholder="10"
                className="w-full"
                disabled={isLoading}
              />
              <p className="text-xs text-gray-500 mt-1">
                5-50 個項目
              </p>
            </div>
          </div>

          {/* 搜尋按鈕 */}
          <div className="mt-6">
            <button
              onClick={handleSearch}
              disabled={!tokenAddress || isLoading}
              className="
                w-full md:w-auto
                bg-gradient-to-r from-blue-600 to-purple-600
                hover:from-blue-700 hover:to-purple-700
                disabled:from-gray-400 disabled:to-gray-500
                disabled:cursor-not-allowed
                text-white font-semibold
                py-3 px-8 rounded-xl
                transition-all duration-300
                transform hover:scale-105 disabled:hover:scale-100
                shadow-lg hover:shadow-xl
              "
            >
              {isLoading ? (
                <div className="flex items-center justify-center gap-2">
                  <div className="animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"></div>
                  查詢中...
                </div>
              ) : (
                "🚀 查詢富豪榜"
              )}
            </button>
          </div>
        </div>

        {/* 錯誤訊息 */}
        {error && (
          <ErrorMessage 
            message={error}
            onRetry={() => handleSearch()}
            className="mb-8"
          />
        )}

        {/* 代幣資訊卡片 */}
        {tokenData && !error && (
          <TokenInfoCard 
            tokenData={tokenData}
            className="mb-8"
          />
        )}

        {/* 載入狀態 */}
        {isLoading && (
          <LoadingSpinner 
            message="正在獲取富豪榜數據..."
            className="mb-8"
          />
        )}

        {/* 富豪榜表格 */}
        {holders.length > 0 && !isLoading && !error && (
          <>
            <RichListTable
              holders={currentHolders}
              tokenSymbol={tokenData?.symbol || "TOKEN"}
              totalSupply={tokenData?.totalSupply}
              startRank={startIndex + 1}
              className="mb-8"
            />

            {/* 分頁控制 */}
            {totalPages > 1 && (
              <PaginationControls
                currentPage={currentPage}
                totalPages={totalPages}
                totalItems={totalHolders}
                itemsPerPage={Number(pageSize)}
                onPageChange={handlePageChange}
              />
            )}
          </>
        )}

        {/* 空狀態 */}
        {holders.length === 0 && !isLoading && !error && tokenAddress && (
          <div className="text-center py-16">
            <div className="text-6xl mb-4">🔍</div>
            <h3 className="text-xl font-semibold text-gray-700 mb-2">
              未找到持有者數據
            </h3>
            <p className="text-gray-500">
              請確認代幣地址正確，或該代幣可能沒有持有者。
            </p>
          </div>
        )}

        {/* 初始狀態 */}
        {!tokenAddress && !isLoading && (
          <div className="text-center py-16">
            <div className="text-6xl mb-4">🎯</div>
            <h3 className="text-xl font-semibold text-gray-700 mb-2">
              開始查詢富豪榜
            </h3>
            <p className="text-gray-500">
              輸入 ERC20 代幣合約地址，查看持有者排行榜。
            </p>
          </div>
        )}
      </div>
    </div>
  );
};

export default RichListPage;
```

#### 2. 代幣資訊卡片組件

建立 `app/rich-list/_components/TokenInfoCard.tsx`：

```tsx
import { formatUnits } from "viem";

interface TokenData {
  name: string;
  symbol: string;
  decimals: number;
  totalSupply: string;
  contractAddress: string;
}

interface TokenInfoCardProps {
  tokenData: TokenData;
  className?: string;
}

export function TokenInfoCard({ tokenData, className = "" }: TokenInfoCardProps) {
  const formattedSupply = formatUnits(
    BigInt(tokenData.totalSupply), 
    tokenData.decimals
  );

  return (
    <div className={`bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl shadow-xl p-8 text-white ${className}`}>
      <div className="flex items-center justify-between mb-6">
        <div>
          <h2 className="text-3xl font-bold mb-2">
            {tokenData.name}
          </h2>
          <div className="bg-white/20 backdrop-blur-sm rounded-full px-4 py-1 inline-block">
            <span className="text-sm font-medium">{tokenData.symbol}</span>
          </div>
        </div>
        <div className="text-right">
          <div className="text-sm opacity-80">總供應量</div>
          <div className="text-2xl font-bold">
            {Number(formattedSupply).toLocaleString()}
          </div>
          <div className="text-sm opacity-80">tokens</div>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
        <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4">
          <div className="opacity-80 mb-1">合約地址</div>
          <div className="font-mono break-all">
            {tokenData.contractAddress.slice(0, 10)}...{tokenData.contractAddress.slice(-8)}
          </div>
        </div>
        
        <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4">
          <div className="opacity-80 mb-1">小數位數</div>
          <div className="font-semibold">{tokenData.decimals}</div>
        </div>
        
        <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4">
          <div className="opacity-80 mb-1">網路</div>
          <div className="font-semibold">Optimism Sepolia</div>
        </div>
      </div>
    </div>
  );
}
```

#### 3. 富豪榜表格組件

建立 `app/rich-list/_components/RichListTable.tsx`：

```tsx
import { Address } from "~~/components/scaffold-alchemy";
import { formatUnits } from "viem";

interface TokenHolder {
  address: string;
  balance: string;
}

interface RichListTableProps {
  holders: TokenHolder[];
  tokenSymbol: string;
  totalSupply?: string;
  startRank: number;
  className?: string;
}

export function RichListTable({ 
  holders, 
  tokenSymbol, 
  totalSupply, 
  startRank,
  className = "" 
}: RichListTableProps) {
  
  const calculatePercentage = (balance: string): number => {
    if (!totalSupply) return 0;
    const balanceNum = Number(formatUnits(BigInt(balance), 18));
    const totalSupplyNum = Number(formatUnits(BigInt(totalSupply), 18));
    return (balanceNum / totalSupplyNum) * 100;
  };

  const formatBalance = (balance: string): string => {
    const formatted = formatUnits(BigInt(balance), 18);
    return Number(formatted).toLocaleString(undefined, {
      maximumFractionDigits: 2,
      minimumFractionDigits: 0,
    });
  };

  return (
    <div className={`bg-white rounded-2xl shadow-xl overflow-hidden ${className}`}>
      <div className="px-8 py-6 bg-gradient-to-r from-gray-50 to-gray-100 border-b">
        <h2 className="text-2xl font-bold text-gray-800">
          🏆 富豪榜排行
        </h2>
        <p className="text-gray-600 mt-1">
          共找到 {holders.length} 個持有者
        </p>
      </div>

      <div className="overflow-x-auto">
        <table className="w-full">
          <thead className="bg-gray-50">
            <tr>
              <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                排名
              </th>
              <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                持有者地址
              </th>
              <th className="px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                持有數量
              </th>
              <th className="px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                佔比
              </th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-200">
            {holders.map((holder, index) => {
              const rank = startRank + index;
              const percentage = calculatePercentage(holder.balance);
              
              return (
                <tr 
                  key={holder.address}
                  className="hover:bg-gray-50 transition-colors duration-200"
                >
                  {/* 排名 */}
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="flex items-center">
                      <div className={`
                        w-8 h-8 rounded-full flex items-center justify-center
                        text-sm font-bold text-white
                        ${rank === 1 ? 'bg-yellow-500' : 
                          rank === 2 ? 'bg-gray-400' :
                          rank === 3 ? 'bg-amber-600' :
                          'bg-blue-500'}
                      `}>
                        {rank <= 3 ? 
                          (rank === 1 ? '🥇' : rank === 2 ? '🥈' : '🥉') :
                          rank
                        }
                      </div>
                    </div>
                  </td>

                  {/* 地址 */}
                  <td className="px-6 py-4 whitespace-nowrap">
                    <Address 
                      address={holder.address}
                      format="short"
                      size="base"
                      blockExplorerAddressLink={true}
                    />
                  </td>

                  {/* 持有數量 */}
                  <td className="px-6 py-4 whitespace-nowrap text-right">
                    <div className="text-sm font-semibold text-gray-900">
                      {formatBalance(holder.balance)} {tokenSymbol}
                    </div>
                  </td>

                  {/* 佔比 */}
                  <td className="px-6 py-4 whitespace-nowrap text-right">
                    <div className="text-sm text-gray-600">
                      {percentage.toFixed(2)}%
                    </div>
                    {/* 視覺化佔比條 */}
                    <div className="w-20 bg-gray-200 rounded-full h-2 ml-auto mt-1">
                      <div 
                        className="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-500"
                        style={{ width: `${Math.min(percentage * 2, 100)}%` }}
                      ></div>
                    </div>
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>
    </div>
  );
}
```

#### 4. 分頁控制組件

建立 `app/rich-list/_components/PaginationControls.tsx`：

```tsx
interface PaginationControlsProps {
  currentPage: number;
  totalPages: number;
  totalItems: number;
  itemsPerPage: number;
  onPageChange: (page: number) => void;
  className?: string;
}

export function PaginationControls({
  currentPage,
  totalPages,
  totalItems,
  itemsPerPage,
  onPageChange,
  className = "",
}: PaginationControlsProps) {
  const startItem = (currentPage - 1) * itemsPerPage + 1;
  const endItem = Math.min(currentPage * itemsPerPage, totalItems);

  const getVisiblePages = () => {
    const delta = 2;
    const range = [];
    const rangeWithDots = [];

    for (
      let i = Math.max(2, currentPage - delta);
      i <= Math.min(totalPages - 1, currentPage + delta);
      i++
    ) {
      range.push(i);
    }

    if (currentPage - delta > 2) {
      rangeWithDots.push(1, "...");
    } else {
      rangeWithDots.push(1);
    }

    rangeWithDots.push(...range);

    if (currentPage + delta < totalPages - 1) {
      rangeWithDots.push("...", totalPages);
    } else {
      rangeWithDots.push(totalPages);
    }

    return rangeWithDots;
  };

  return (
    <div className={`bg-white rounded-xl shadow-lg p-6 ${className}`}>
      <div className="flex flex-col sm:flex-row justify-between items-center gap-4">
        {/* 資訊顯示 */}
        <div className="text-sm text-gray-600">
          顯示第 <span className="font-semibold">{startItem}</span> 至{" "}
          <span className="font-semibold">{endItem}</span> 項，
          共 <span className="font-semibold">{totalItems}</span> 項
        </div>

        {/* 分頁按鈕 */}
        <div className="flex items-center gap-1">
          {/* 上一頁 */}
          <button
            onClick={() => onPageChange(currentPage - 1)}
            disabled={currentPage === 1}
            className="
              px-3 py-2 text-sm font-medium
              text-gray-500 hover:text-gray-700
              bg-white hover:bg-gray-50
              border border-gray-300 rounded-l-lg
              disabled:opacity-50 disabled:cursor-not-allowed
              transition-colors duration-200
            "
          >
            上一頁
          </button>

          {/* 頁碼按鈕 */}
          {getVisiblePages().map((page, index) => (
            <button
              key={index}
              onClick={() => typeof page === "number" && onPageChange(page)}
              disabled={page === "..." || page === currentPage}
              className={`
                px-3 py-2 text-sm font-medium
                border-t border-b border-r border-gray-300
                transition-colors duration-200
                ${
                  page === currentPage
                    ? "bg-blue-600 text-white border-blue-600 z-10"
                    : page === "..."
                    ? "text-gray-400 cursor-default"
                    : "text-gray-700 hover:text-blue-600 bg-white hover:bg-gray-50"
                }
              `}
            >
              {page}
            </button>
          ))}

          {/* 下一頁 */}
          <button
            onClick={() => onPageChange(currentPage + 1)}
            disabled={currentPage === totalPages}
            className="
              px-3 py-2 text-sm font-medium
              text-gray-500 hover:text-gray-700
              bg-white hover:bg-gray-50
              border border-gray-300 rounded-r-lg
              disabled:opacity-50 disabled:cursor-not-allowed
              transition-colors duration-200
            "
          >
            下一頁
          </button>
        </div>
      </div>
    </div>
  );
}
```

#### 5. 載入和錯誤狀態組件

建立 `app/rich-list/_components/LoadingSpinner.tsx`：

```tsx
interface LoadingSpinnerProps {
  message?: string;
  className?: string;
}

export function LoadingSpinner({ 
  message = "載入中...", 
  className = "" 
}: LoadingSpinnerProps) {
  return (
    <div className={`bg-white rounded-2xl shadow-xl p-12 text-center ${className}`}>
      <div className="flex flex-col items-center gap-4">
        <div className="relative">
          <div className="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
          <div className="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin absolute top-2 left-2 animate-pulse"></div>
        </div>
        <div>
          <h3 className="text-lg font-semibold text-gray-700 mb-2">
            {message}
          </h3>
          <p className="text-gray-500 text-sm">
            正在從區塊鏈獲取最新數據...
          </p>
        </div>
      </div>
    </div>
  );
}
```

建立 `app/rich-list/_components/ErrorMessage.tsx`：

```tsx
interface ErrorMessageProps {
  message: string;
  onRetry?: () => void;
  className?: string;
}

export function ErrorMessage({ 
  message, 
  onRetry, 
  className = "" 
}: ErrorMessageProps) {
  return (
    <div className={`bg-red-50 border border-red-200 rounded-2xl p-8 ${className}`}>
      <div className="flex flex-col items-center text-center gap-4">
        <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center">
          <span className="text-2xl">⚠️</span>
        </div>
        <div>
          <h3 className="text-lg font-semibold text-red-800 mb-2">
            查詢失敗
          </h3>
          <p className="text-red-600 mb-4">
            {message}
          </p>
          {onRetry && (
            <button
              onClick={onRetry}
              className="
                bg-red-600 hover:bg-red-700
                text-white font-medium
                py-2 px-6 rounded-lg
                transition-colors duration-200
              "
            >
              重試
            </button>
          )}
        </div>
      </div>
    </div>
  );
}
```

### 🔗 自定義 Hook 實作

建立 `hooks/useTokenHolders.ts`：

```typescript
import { useState, useCallback } from "react";

interface TokenData {
  name: string;
  symbol: string;
  decimals: number;
  totalSupply: string;
  contractAddress: string;
}

interface TokenHolder {
  address: string;
  balance: string;
}

interface UseTokenHoldersReturn {
  data: TokenData | null;
  holders: TokenHolder[];
  totalHolders: number;
  isLoading: boolean;
  error: string | null;
  fetchTokenHolders: (address: string, pageSize: number) => Promise<void>;
}

export function useTokenHolders(): UseTokenHoldersReturn {
  const [data, setData] = useState<TokenData | null>(null);
  const [holders, setHolders] = useState<TokenHolder[]>([]);
  const [totalHolders, setTotalHolders] = useState(0);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchTokenHolders = useCallback(async (address: string, pageSize: number) => {
    setIsLoading(true);
    setError(null);

    try {
      // 這裡將在下個單元實作 Alchemy API 整合
      const response = await fetch('/api/token-holders', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contractAddress: address,
          pageSize,
        }),
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.json();

      setData(result.tokenData);
      setHolders(result.holders);
      setTotalHolders(result.totalHolders);
    } catch (err) {
      console.error('Error fetching token holders:', err);
      setError(
        err instanceof Error 
          ? err.message 
          : '獲取代幣持有者數據時發生錯誤'
      );
    } finally {
      setIsLoading(false);
    }
  }, []);

  return {
    data,
    holders,
    totalHolders,
    isLoading,
    error,
    fetchTokenHolders,
  };
}
```

### 🎨 樣式優化

#### 1. 全域樣式更新

在 `styles/globals.css` 中添加自定義樣式：

```css
/* 富豪榜頁面特定樣式 */
.rich-list-gradient {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.rich-list-card {
  @apply bg-white/90 backdrop-blur-sm border border-white/20 shadow-xl;
}

.rich-list-table-row {
  @apply hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-300;
}

/* 動畫效果 */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in-up {
  animation: fadeInUp 0.6s ease-out forwards;
}

/* 響應式字體大小 */
.responsive-text {
  @apply text-sm sm:text-base lg:text-lg;
}

/* 自定義滾動條 */
.custom-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: #cbd5e0 #f7fafc;
}

.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: #f7fafc;
  border-radius: 4px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #cbd5e0;
  border-radius: 4px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: #a0aec0;
}
```

#### 2. 響應式佈局優化

```tsx
// 在主頁面組件中添加響應式類別
<div className="
  container mx-auto 
  px-4 sm:px-6 lg:px-8 
  py-8 lg:py-12 
  max-w-7xl
">
  {/* 標題區域 */}
  <div className="text-center mb-8 lg:mb-12">
    <h1 className="
      text-3xl sm:text-4xl lg:text-5xl xl:text-6xl 
      font-bold text-gray-900 mb-4
    ">
      🏆 ERC20 富豪榜查詢
    </h1>
    <p className="
      text-base sm:text-lg lg:text-xl 
      text-gray-600 
      max-w-2xl lg:max-w-3xl 
      mx-auto
    ">
      輸入任何 ERC20 代幣合約地址，即時查看代幣持有者排行榜。
    </p>
  </div>
  
  {/* 其他內容... */}
</div>
```

### 🧪 測試頁面功能

#### 1. 建立測試數據

為了在開發階段測試頁面，可以建立模擬數據：

```typescript
// utils/mockData.ts
export const mockTokenData = {
  name: "RichList Demo Token",
  symbol: "RDT",
  decimals: 18,
  totalSupply: "1000000000000000000000000", // 1M tokens
  contractAddress: "0x1234567890123456789012345678901234567890",
};

export const mockHolders = [
  {
    address: "0x742d35Cc6634C0532925a3b8D238C1e8D8F6D9E8",
    balance: "50000000000000000000000", // 50k tokens
  },
  {
    address: "0x8ba1f109551bD432803012645Hac136c22C8C7c",
    balance: "30000000000000000000000", // 30k tokens
  },
  // ... 更多測試數據
];
```

#### 2. 開發模式切換

```typescript
// 在 useTokenHolders hook 中添加開發模式
const isDevelopment = process.env.NODE_ENV === 'development';

const fetchTokenHolders = useCallback(async (address: string, pageSize: number) => {
  setIsLoading(true);
  setError(null);

  try {
    if (isDevelopment) {
      // 開發模式使用模擬數據
      await new Promise(resolve => setTimeout(resolve, 1000)); // 模擬網路延遲
      setData(mockTokenData);
      setHolders(mockHolders);
      setTotalHolders(mockHolders.length);
      return;
    }

    // 生產模式使用真實 API
    // ... 實際 API 調用代碼
  } catch (err) {
    // ... 錯誤處理
  } finally {
    setIsLoading(false);
  }
}, []);
```

### 📱 移動端優化

#### 1. 響應式表格

```tsx
// 在 RichListTable 組件中添加移動端優化
<div className="block sm:hidden">
  {/* 移動端卡片佈局 */}
  {holders.map((holder, index) => (
    <div key={holder.address} className="bg-gray-50 rounded-lg p-4 mb-4">
      <div className="flex justify-between items-start mb-2">
        <div className="flex items-center gap-2">
          <div className="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold">
            {startRank + index}
          </div>
          <Address address={holder.address} format="short" size="sm" />
        </div>
      </div>
      <div className="text-right">
        <div className="font-semibold text-gray-900">
          {formatBalance(holder.balance)} {tokenSymbol}
        </div>
        <div className="text-sm text-gray-500">
          {calculatePercentage(holder.balance).toFixed(2)}%
        </div>
      </div>
    </div>
  ))}
</div>

<div className="hidden sm:block">
  {/* 桌面端表格佈局 */}
  <table className="w-full">
    {/* ... 原有表格代碼 */}
  </table>
</div>
```

### ✅ 小結

在這一課中，我們成功建立了完整的富豪榜查詢頁面：

✅ **完整的頁面結構**
- 美觀的用戶界面設計
- 響應式佈局支援
- 模組化組件架構

✅ **功能齊全的元件**
- 代幣地址輸入和驗證
- 富豪榜數據展示表格
- 分頁控制和導航

✅ **優秀的用戶體驗**
- 載入狀態和錯誤處理
- 動畫效果和視覺反饋
- 移動端優化設計

✅ **可維護的代碼結構**
- 自定義 Hooks 進行狀態管理
- TypeScript 型別安全
- 模組化組件設計

在下個單元中，我們將整合 Alchemy API 來獲取真實的區塊鏈數據，讓我們的富豪榜功能真正運作起來！

---

**準備好讓你的 DApp 連接真實的區塊鏈數據了嗎？** 🌐
