# 第三課：專案初始化與環境設定

## 🛠️ 環境準備檢查清單

在開始之前，請確認你的開發環境已經準備就緒：

### 必備軟體

- [ ] **Node.js v18+** 
  ```bash
  node --version  # 應該顯示 v18.0.0 或更高版本
  ```
  
- [ ] **Yarn v1.22+**
  ```bash
  yarn --version  # 應該顯示 1.22.0 或更高版本
  ```

- [ ] **Git**
  ```bash
  git --version   # 確認已安裝 Git
  ```

- [ ] **VS Code** (推薦) 或其他代碼編輯器

### 瀏覽器錢包設定

- [ ] **安裝 MetaMask** 或其他 Web3 錢包
- [ ] **建立測試錢包** (請勿使用主錢包進行開發測試)

### API 服務準備

- [ ] **註冊 Alchemy 帳戶**：前往 [alchemy.com](https://alchemy.com) 註冊
- [ ] **獲取 API Key**：建立新的 App 並取得 API Key

## 🚀 專案初始化步驟

### 步驟 1：使用 Scaffold-Alchemy 建立專案

開啟終端機，執行以下命令：

```bash
# 使用 create-web3-dapp 建立新專案
npx create-web3-dapp erc20-rich-list

# 選擇選項：
# ✅ Framework: Next.js
# ✅ Backend: Hardhat
# ✅ Chain: Optimism Sepolia
# ✅ Styling: Tailwind CSS
# ✅ Package Manager: Yarn
```

### 步驟 2：進入專案目錄

```bash
cd erc20-rich-list
```

### 步驟 3：安裝依賴套件

```bash
# 安裝根目錄依賴
yarn install

# 安裝 Hardhat 依賴
cd packages/hardhat
yarn install

# 安裝 Next.js 依賴
cd ../nextjs
yarn install

# 回到根目錄
cd ../..
```

## 📁 專案結構導覽

讓我們詳細了解專案的目錄結構：

```
erc20-rich-list/
├── 📁 packages/
│   ├── 📁 hardhat/              # 智能合約開發環境
│   │   ├── 📁 contracts/        # 智能合約源碼
│   │   │   └── Counter.sol      # 範例合約
│   │   ├── 📁 deploy/           # 部署腳本
│   │   │   └── 00_deploy_counter.ts
│   │   ├── 📁 test/             # 合約測試
│   │   │   └── Counter.ts
│   │   ├── hardhat.config.ts    # Hardhat 配置
│   │   └── package.json
│   │
│   └── 📁 nextjs/               # 前端應用
│       ├── 📁 app/              # Next.js 13+ App Router
│       │   ├── layout.tsx       # 根佈局
│       │   ├── page.tsx         # 首頁
│       │   └── providers.tsx    # Context Providers
│       ├── 📁 components/       # React 元件
│       │   ├── 📁 scaffold-alchemy/  # 內建元件庫
│       │   │   ├── 📁 Address/       # 地址顯示元件
│       │   │   ├── 📁 Input/         # 輸入元件
│       │   │   └── 📁 ConnectButton/ # 錢包連接按鈕
│       │   ├── Header.tsx       # 網站標題列
│       │   └── Footer.tsx       # 網站頁腳
│       ├── 📁 hooks/            # 自定義 Hooks
│       │   └── 📁 scaffold-alchemy/ # 框架提供的 Hooks
│       ├── 📁 services/         # 服務層
│       ├── 📁 utils/            # 工具函數
│       ├── 📁 contracts/        # 合約 ABI 和地址
│       ├── scaffold.config.ts   # Scaffold 配置
│       └── package.json
├── README.md
└── package.json                 # 根目錄配置
```

### 🔍 重要檔案說明

**`packages/hardhat/hardhat.config.ts`**
```typescript
// Hardhat 配置檔案，定義網路、編譯器設定等
import { HardhatUserConfig } from "hardhat/config";
import "@nomicfoundation/hardhat-toolbox";

const config: HardhatUserConfig = {
  solidity: "0.8.19",
  networks: {
    optimismSepolia: {
      url: "https://sepolia.optimism.io",
      accounts: [process.env.DEPLOYER_PRIVATE_KEY!],
    },
  },
};
```

**`packages/nextjs/scaffold.config.ts`**
```typescript
// Scaffold-Alchemy 主要配置檔案
import { Chain } from "viem";
import { optimismSepolia } from "viem/chains";

const scaffoldConfig = {
  targetNetworks: [optimismSepolia] as readonly Chain[],
  pollingInterval: 30000,
  alchemyApiKey: process.env.NEXT_PUBLIC_ALCHEMY_API_KEY,
  walletConnectProjectId: process.env.NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID,
} as const;
```

## ⚙️ 環境變數設定

### 步驟 1：建立環境變數檔案

在 `packages/hardhat/` 目錄下建立 `.env` 檔案：

```bash
cd packages/hardhat
touch .env
```

### 步驟 2：設定 Hardhat 環境變數

編輯 `packages/hardhat/.env`：

```env
# 部署用的私鑰 (測試錢包，不要使用主錢包!)
DEPLOYER_PRIVATE_KEY=your_test_wallet_private_key_here

# Alchemy API Key
ALCHEMY_API_KEY=your_alchemy_api_key_here

# Optimism Sepolia RPC URL
OPTIMISM_SEPOLIA_RPC_URL=https://opt-sepolia.g.alchemy.com/v2/your_api_key_here
```

### 步驟 3：設定 Next.js 環境變數

在 `packages/nextjs/` 目錄下建立 `.env.local` 檔案：

```bash
cd ../nextjs
touch .env.local
```

編輯 `packages/nextjs/.env.local`：

```env
# Alchemy API Key (前端使用)
NEXT_PUBLIC_ALCHEMY_API_KEY=your_alchemy_api_key_here

# WalletConnect Project ID (可選)
NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID=your_wallet_connect_project_id

# 網路配置
NEXT_PUBLIC_ENABLE_TESTNETS=true
```

## 🌐 設定 Optimism Sepolia 測試網

### 步驟 1：在 MetaMask 中添加 Optimism Sepolia

手動添加網路，或使用以下資訊：

```
網路名稱: Optimism Sepolia
RPC URL: https://sepolia.optimism.io
Chain ID: 11155420
符號: ETH
區塊瀏覽器: https://sepolia-optimism.etherscan.io
```

### 步驟 2：獲取測試用 ETH

1. 前往 [Optimism Sepolia Faucet](https://faucet.quicknode.com/optimism/sepolia)
2. 輸入你的測試錢包地址
3. 獲取免費的測試 ETH

### 步驟 3：驗證網路連接

```bash
# 在 packages/hardhat 目錄下測試網路連接
cd packages/hardhat
npx hardhat run scripts/verify-network.js --network optimismSepolia
```

## 🧪 測試專案設定

### 步驟 1：啟動本地開發環境

開啟三個終端視窗：

**終端 1 - Hardhat 本地節點 (可選):**
```bash
cd packages/hardhat
yarn chain
```

**終端 2 - 部署合約:**
```bash
cd packages/hardhat
yarn deploy --network optimismSepolia
```

**終端 3 - 啟動前端:**
```bash
cd packages/nextjs
yarn dev
```

### 步驟 2：驗證部署成功

1. 開啟瀏覽器前往 `http://localhost:3000`
2. 連接你的 MetaMask 錢包
3. 確認能看到 Scaffold-Alchemy 的預設介面
4. 測試錢包連接功能

### 步驟 3：檢查合約部署

```bash
# 查看部署的合約地址
cd packages/hardhat
cat deployments/optimismSepolia/Counter.json
```

## 🐛 常見問題與解決方案

### 問題 1：私鑰格式錯誤

**錯誤訊息：** `Error: private key must be exactly 32 bytes`

**解決方案：**
```env
# 確保私鑰格式正確，包含 0x 前綴
DEPLOYER_PRIVATE_KEY=0x1234567890abcdef...
```

### 問題 2：RPC 連接失敗

**錯誤訊息：** `Error: network does not exist`

**解決方案：**
1. 檢查 Alchemy API Key 是否正確
2. 確認網路配置是否正確
3. 測試網路連接：
```bash
curl -X POST https://opt-sepolia.g.alchemy.com/v2/YOUR_API_KEY \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'
```

### 問題 3：Gas 費用不足

**錯誤訊息：** `Error: insufficient funds for gas`

**解決方案：**
1. 確認測試錢包有足夠的 ETH
2. 從 faucet 獲取更多測試 ETH
3. 降低 gas limit 設定

### 問題 4：端口被佔用

**錯誤訊息：** `Error: listen EADDRINUSE: address already in use :::3000`

**解決方案：**
```bash
# 查找佔用端口的程序
lsof -ti:3000

# 終止程序
kill -9 $(lsof -ti:3000)

# 或使用不同端口
yarn dev --port 3001
```

## ✅ 設定完成檢查清單

完成以下檢查項目，確保環境設定正確：

- [ ] Node.js 和 Yarn 版本正確
- [ ] 專案依賴安裝完成
- [ ] 環境變數設定正確
- [ ] MetaMask 連接到 Optimism Sepolia
- [ ] 測試錢包有足夠的 ETH
- [ ] 合約部署成功
- [ ] 前端應用正常運行
- [ ] 錢包連接功能正常

## 🎉 恭喜！

你已經成功設定了 Scaffold-Alchemy 開發環境！現在你擁有了：

✅ **完整的開發環境**：Hardhat + Next.js + TypeScript  
✅ **測試網路連接**：Optimism Sepolia 配置完成  
✅ **API 服務整合**：Alchemy API 準備就緒  
✅ **錢包整合**：MetaMask 連接正常  

在下個單元中，我們將開始編寫和部署我們的 ERC20 代幣合約。準備好進入真正的開發階段了嗎？

---

**環境準備完成，讓我們開始編寫智能合約吧！** 🚀
